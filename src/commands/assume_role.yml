description: >
  This command will assume a role

steps:
  - run:
      name: Act as AWS admin
      command: |
        # Manually assume role to get temporary aws credentials
        assume_creds=$(aws sts assume-role --role-session-name circleci --duration-seconds 7200 --role-arn "arn:aws:iam::${AWS_ACCOUNT_ID}:role/${ASSUME_AWS_PROFILE}")
        {
          echo "export AWS_ACCESS_KEY_ID=$(echo $assume_creds | jq -r .Credentials.AccessKeyId)"
          echo "export AWS_SECRET_ACCESS_KEY=$(echo $assume_creds | jq -r .Credentials.SecretAccessKey)"
          echo "export AWS_SESSION_TOKEN=$(echo $assume_creds | jq -r .Credentials.SessionToken)"
          echo "export AWS_SDK_LOAD_CONFIG=1"
        } >> $BASH_ENV
